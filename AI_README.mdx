# AI開発者向けガイド: Notion-Astroブログシステム

このドキュメントは、AIアシスタントがこのプロジェクトを理解し、開発支援を行うための情報を提供します。

## プロジェクト概要

このプロジェクトは、NotionをCMSとして使用し、Astroフレームワークでウェブサイト/ブログを構築するシステムです。Notion
APIを通じてコンテンツを取得し、Astroを使って静的サイトを生成します。

## ファイル構造の重要ポイント

```
/
├── src/
│   ├── components/     # UIコンポーネント
│   │   └── NotionBlock.tsx  # Notionブロックのレンダリング（重要）
│   ├── layouts/        # ページレイアウト
│   ├── lib/
│   │   └── notion.ts   # Notion API連携（重要）
│   ├── pages/          # ルーティング
│   ├── styles/         # スタイル定義
│   └── types/          # 型定義
│       └── notion.ts   # Notion関連の型定義（重要）
├── .env                # 環境変数（APIキーなど）
└── astro.config.mjs    # Astro設定
```

## 重要なコード領域と機能

### 1. Notion API連携 (`src/lib/notion.ts`)

このファイルは、Notion APIとの通信を担当します。主な機能:

- データベースからの記事一覧取得
- 個別ページの詳細情報取得
- Notionブロックの再帰的な取得と処理

このファイルを修正する際は、Notion APIのレート制限に注意してください。キャッシュ機構の実装も検討すべきです。

### 2. Notionブロックレンダリング (`src/components/NotionBlock.tsx`)

NotionのブロックをReactコンポーネントとしてレンダリングします。各ブロックタイプ（段落、見出し、リスト、コードなど）に対応するレンダラーが実装されています。

未対応のブロックタイプがある場合は、このファイルに新しいレンダラーを追加する必要があります。

### 3. ルーティング (`src/pages/`)

Astroのファイルベースルーティングを使用しています:

- `index.astro`: ホームページ
- `posts/[slug].astro`: 個別記事ページ（動的ルーティング）
- `tags/[tag].astro`: タグ別記事一覧ページ

### 4. 環境変数

開発には以下の環境変数が必要です:

- `NOTION_TOKEN`: Notion APIキー
- `NOTION_DATABASE_ID`: 記事データベースのID

## AI開発支援のためのヒント

### コードの補完・提案において

1. **Notion APIの知識を活用**: `@notionhq/client`の仕様に基づいて、正確なAPIコール方法を提案してください。

2. **型定義の厳格さ**: TypeScriptの型定義が厳密に行われています。特に`src/types/notion.ts`の型定義に従ってコードを提案してください。

3. **Astroの特性**: Astroはサーバーコンポーネントと部分的なhydrationを使用しています。`.astro`
   ファイルではサーバーサイドのコードと、クライアントに送信されるHTMLを明確に区別してください。

4. **コンポーネント境界**: ReactコンポーネントはNotionブロックのレンダリングに限定して使用されています。基本的なページ構造はAstroコンポーネントで実装されています。

### デバッグ支援において

1. **Notion API関連のエラー**:

- 403エラー → 権限問題（インテグレーションがデータベースと共有されているか確認）
- 429エラー → レート制限（リクエスト回数の制限）

2. **Astroビルドエラー**:

- SSRモード時とSSGモード時で動作が異なる可能性があります
- `import.meta.env`の使用に注意（環境変数はこの方法でアクセス）

### 機能拡張の提案において

1. **パフォーマンス最適化**:

- Notionデータのキャッシュ機構
- 画像の最適化（Astroの画像最適化機能を使用）

2. **未対応のNotionブロック**:

- データベースビュー
- 埋め込みコンテンツ
- 同期ブロック
- API最新アップデートへの対応

3. **SEO最適化**:

- メタデータの充実
- 構造化データの実装

## インテグレーションテスト用サンプルデータ

テスト用に以下のようなNotionブロック構造を想定できます:

```typescript
// 段落ブロックの例
const paragraphBlock = {
    type: "paragraph",
    paragraph: {
        rich_text: [
            {
                type: "text",
                text: {content: "これはテスト段落です", link: null},
                annotations: {bold: false, italic: false, ...}
            }
        ]
    }
};

// 見出しブロックの例
const headingBlock = {
    type: "heading_1",
    heading_1: {
        rich_text: [
            {type: "text", text: {content: "見出し1", link: null}, ...}
        ]
    }
};
```

## CI/CDワークフローの理解

デプロイパイプラインは以下のステップで動作します:

1. GitHubへのプッシュ
2. 自動ビルド（Vercel/Netlify/Cloudflare Pages）
3. 環境変数の注入
4. 静的サイト生成
5. CDNデプロイ

## コントリビューションガイドライン

コード提案時には以下の原則を考慮してください:

1. **タイプセーフ**: 厳格な型定義を維持
2. **パフォーマンス**: Notionへの不要なAPIコールを避ける
3. **アクセシビリティ**: 基本的なWCAGガイドラインに準拠
4. **コード分割**: 大きな機能は適切に分割

## 将来の拡張計画

このプロジェクトでは以下の機能追加が検討されています:

1. コメント機能
2. 多言語サポート
3. 検索機能
4. アナリティクス統合

これらの機能追加を見据えたコード提案が有用です。

---

このAI_READMEは、AIアシスタントがプロジェクトの全体像を素早く把握し、的確な開発支援を提供するための参考資料です。新しい機能やベストプラクティスに基づくコード改善の提案を歓迎します。
